jQuery(document).ready(function($){google.maps.visualRefresh=true;var map,max_height=528,last_marker=false,last_window=false,latlng=new google.maps.LatLng(38.635,-90.258);function initialize(){var mapOptions={zoom:16,disableDefaultUI:true,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions);max_height=$("#location-list").data("max_height");$(".child").each(function(){$(this).css({"max-height":max_height})});$("#location-list .child").first().show().addClass("expanded");
$("#location-list li a").each(function(index){var id=$(this).attr("data-page_id"),nonce=$(this).attr("data-nonce"),x=$(this).attr("data-xcoord"),y=$(this).attr("data-ycoord"),myLatlng=new google.maps.LatLng(x,y),image="/wp-content/plugins/wusm-maps/map_marker_closed.png",marker=new google.maps.Marker({position:myLatlng,map:map,title:"",icon:image});google.maps.event.addListener(marker,"click",function(){show_location_info(id,nonce)})}).on("click",function(e){var id=$(this).attr("data-page_id"),nonce=
$(this).attr("data-nonce");show_location_info(id,nonce);$(".open").removeClass();$(this).parent().addClass("open")});$(".parent").on("click",function(){if(!$(this).children(".child").hasClass("expanded")){$(".expanded").slideToggle().removeClass("expanded");$(this).children(".child").slideToggle().addClass("expanded")}}).children().click(function(e){return false})}if($("#map-container")[0])google.maps.event.addDomListener(window,"load",initialize);function show_location_info(i,n){$.ajax({type:"post",
url:ajaxurl,data:{"action":"show_location","id":i,"nonce":n},success:function(data){close_em();var location_obj=jQuery.parseJSON(data),content="",coords_array=location_obj.coords.split(",");if(location_obj.image)content+="<img class='loc-image' src="+location_obj.image+">";content+="<div class='loc-div'><h3>"+location_obj.title+"</h3>"+location_obj.content+"</div>";content+="<form id='get-directions-box' action='http://maps.google.com/maps' method='get'>";content+="<input type='text' name='saddr' placeholder='Type your address' id='address'>";
content+="<input type='hidden' name='daddr' value='"+coords_array[0]+","+coords_array[1]+"'>";content+="<button id='get-directions'>Get Directions</button></form>";var myLatlng=new google.maps.LatLng(parseFloat(coords_array[0]),parseFloat(coords_array[1])),infowindow=new google.maps.InfoWindow({content:content,maxWidth:495}),image="/wp-content/plugins/wusm-maps/map_marker_open.png",marker=new google.maps.Marker({position:myLatlng,map:map,title:location_obj.title,icon:image});google.maps.event.addListener(infowindow,
"closeclick",function(){close_em()});infowindow.open(map,marker);last_marker=marker;last_window=infowindow},error:function(errorThrown){console.log(errorThrown)}})}$("#map-reset").click(function(){map.setCenter(latlng);map.setZoom(16);close_em()});function close_em(){if(last_marker){last_window.close();last_window=false;last_marker.setMap(null);last_marker=false}}});